\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[portuguese]{babel}
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{titlesec}
\usepackage{enumitem}
\usepackage{float}
\usepackage{caption}

% Configuração da página
\geometry{left=3cm,right=2cm,top=3cm,bottom=2cm}

% Configuração de cabeçalho e rodapé
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{UFMA - Redes de Computadores II}
\fancyhead[R]{Sala de Bate-Papo}
\fancyfoot[C]{\thepage}

% Configuração do código
\lstset{
    language=Python,
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\color{blue},
    commentstyle=\color{gray},
    stringstyle=\color{red},
    numbers=left,
    numberstyle=\tiny\color{gray},
    stepnumber=1,
    numbersep=10pt,
    backgroundcolor=\color{gray!10},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    frame=single,
    rulecolor=\color{black},
    tabsize=2,
    captionpos=b,
    breaklines=true,
    breakatwhitespace=false
}

% Configuração de links
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,
    urlcolor=cyan,
    citecolor=green
}

\begin{document}

% Página de título
\begin{titlepage}
    \centering
    
    % Logo da universidade (se disponível)
    % \includegraphics[width=0.15\textwidth]{ufma_logo.png}\\[1cm]
    
    {\Large \textbf{UNIVERSIDADE FEDERAL DO MARANHÃO}}\\[0.3cm]
    {\large DEPARTAMENTO DE INFORMÁTICA}\\[0.3cm]
    {\large CURSO DE CIÊNCIA DA COMPUTAÇÃO}\\[1.5cm]
    
    {\huge \textbf{SALA DE BATE-PAPO}}\\[0.3cm]
    {\Large \textbf{Implementação de Chat Room com Transferência de Arquivos}}\\[0.3cm]
    {\large Utilizando Paradigma Cliente-Servidor e API de Sockets}\\[2cm]
    
    {\large \textbf{Disciplina:} Redes de Computadores II}\\[0.3cm]
    {\large \textbf{Professor:} Mário Meireles Teixeira}\\[2cm]
    
    {\large \textbf{Alunos:} [Vinicius Santos Cerveira, Gabriel Belo Pereira dos Reis e Elivelton Botelho Pinheiro.]}\\
    
    {\large São Luís - MA}\\
    {\large \today}
    
\end{titlepage}

% Sumário
\tableofcontents
\newpage

% 1. INTRODUÇÃO
\section{Introdução}

Este relatório apresenta a implementação de uma sala de bate-papo (chat room) desenvolvida como trabalho prático da disciplina de Redes de Computadores II. O sistema foi construído seguindo o paradigma cliente-servidor, utilizando a API de sockets da linguagem Python para estabelecer comunicação em tempo real entre múltiplos usuários.

\subsection{Objetivos}

O projeto teve como objetivos principais:

\begin{itemize}
    \item Implementar um sistema de chat em tempo real para múltiplos usuários
    \item Aplicar conceitos de programação com sockets TCP/IP
    \item Desenvolver sistema de autenticação de usuários
    \item Implementar comunicação concorrente utilizando threads
    \item Adicionar funcionalidade de transferência de arquivos entre clientes
\end{itemize}

\subsection{Especificações do Sistema}

O sistema desenvolvido atende aos seguintes requisitos:

\begin{itemize}
    \item Suporte para até 10 clientes simultâneos
    \item Autenticação por usuário e senha
    \item Replicação de mensagens para todos os clientes conectados
    \item Comandos especiais para controle do sistema
    \item Implementação de threads para recepção e envio simultâneos
    \item Transferência de arquivos entre clientes (desafio opcional)
\end{itemize}

% 2. METODOLOGIA
\section{Metodologia}

\subsection{Tecnologias Utilizadas}

\begin{itemize}
    \item \textbf{Linguagem:} Python 3.x
    \item \textbf{Protocolo:} TCP/IP
    \item \textbf{Bibliotecas:} socket, threading, base64, os, time
    \item \textbf{Paradigma:} Cliente-Servidor
    \item \textbf{Arquitetura:} Multithreaded
\end{itemize}

\subsection{Arquitetura do Sistema}

O sistema foi desenvolvido seguindo a arquitetura cliente-servidor, onde:

\begin{itemize}
    \item \textbf{Servidor:} Atua como hub central, gerenciando conexões e retransmitindo mensagens
    \item \textbf{Clientes:} Conectam-se ao servidor para enviar e receber mensagens
    \item \textbf{Comunicação:} Bidirecional através de sockets TCP
\end{itemize}

% 3. IMPLEMENTAÇÃO
\section{Implementação}

\subsection{Servidor (servidor.py)}

O servidor foi implementado na classe \texttt{Servidor}, que possui as seguintes funcionalidades:

\subsubsection{Inicialização e Configuração}

\begin{lstlisting}[caption=Inicialização do servidor]
class Servidor:
    clientes = []
    credenciais_validas = {
        'admin': 'admin',
        'user1': 'senha1',
        'user2': 'senha2',
        # ... até user10
    }
    
    def __init__(self, host, porta):
        self.socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.socket.bind((host, porta))
        self.socket.listen(10)
        print('Servidor iniciado e aguardando conexões...')
\end{lstlisting}

\subsubsection{Gerenciamento de Clientes}

O servidor utiliza threads para gerenciar cada cliente conectado:

\begin{lstlisting}[caption=Gerenciamento de clientes]
def lidar_com_cliente(self, cliente):
    socket_cliente = cliente["socket"]
    nome_cliente = cliente["nome"]
    
    while True:
        try:
            mensagem = socket_cliente.recv(4096).decode()
        except:
            break
            
        if mensagem.strip().lower() == "exit":
            self.enviar_mensagem_global(f"{nome_cliente} saiu da sala.")
            Servidor.clientes.remove(cliente)
            socket_cliente.close()
            break
        elif mensagem.startswith("FILE:"):
            self.processar_arquivo(mensagem, nome_cliente)
        else:
            self.enviar_mensagem_global(
                f"{nome_cliente}: {mensagem}", remetente=nome_cliente
            )
\end{lstlisting}

\subsection{Cliente (cliente.py)}

O cliente foi implementado na classe \texttt{Cliente}, com as seguintes características:

\subsubsection{Autenticação}

\begin{lstlisting}[caption=Sistema de autenticação]
def enviar_credenciais(self):
    credenciais = f"{self.nome}:{self.senha}"
    self.socket.send(credenciais.encode())
    
    # Aguarda resposta de autenticação
    resposta = self.socket.recv(1024).decode()
    if "falhou" in resposta.lower():
        print("❌ Autenticação falhou! Conexão encerrada.")
        self.socket.close()
        os._exit(0)
    print("✅ Conectado com sucesso!")
\end{lstlisting}

\subsubsection{Threading para Comunicação Bidirecional}

\begin{lstlisting}[caption=Implementação de threads no cliente]
def __init__(self):
    # ... configuração inicial ...
    
    # Thread para receber mensagens
    Thread(target=self.receber_mensagens).start()
    
    # Thread principal para enviar mensagens
    self.enviar_mensagens()
\end{lstlisting}

\subsection{Transferência de Arquivos}

A funcionalidade de transferência de arquivos foi implementada como desafio opcional:

\subsubsection{Protocolo de Transferência}

O protocolo desenvolvido utiliza o formato:
\begin{center}
\texttt{FILE:nome\_arquivo:dados\_base64}
\end{center}

\begin{lstlisting}[caption=Envio de arquivo no cliente]
def enviar_arquivo(self, nome_arquivo):
    try:
        with open(nome_arquivo, "rb") as arquivo:
            dados_arquivo = arquivo.read()
            dados_base64 = base64.b64encode(dados_arquivo).decode()
        
        mensagem_arquivo = f"FILE:{nome_arquivo}:{dados_base64}"
        self.socket.send(mensagem_arquivo.encode())
        print(f"Arquivo '{nome_arquivo}' enviado!")
    except Exception as e:
        print(f"❌ Erro ao enviar arquivo: {e}")
\end{lstlisting}

% 4. FUNCIONALIDADES
\section{Funcionalidades Desenvolvidas}

\subsection{Funcionalidades Obrigatórias}

\begin{enumerate}
    \item \textbf{Autenticação de Usuários:} Sistema com 11 usuários pré-cadastrados
    \item \textbf{Chat em Tempo Real:} Mensagens replicadas instantaneamente
    \item \textbf{Múltiplos Clientes:} Suporte para até 10 conexões simultâneas
    \item \textbf{Comando Exit/Quit:} Saída controlada com notificação
    \item \textbf{Comando Shutdown:} Encerramento gracioso do servidor
    \item \textbf{Threading:} Comunicação bidirecional sem bloqueios
\end{enumerate}

\subsection{Funcionalidades Opcionais}

\begin{enumerate}
    \item \textbf{Transferência de Arquivos:} Envio de qualquer tipo de arquivo
    \item \textbf{Interface Colorida:} Mensagens destacadas em cores
    \item \textbf{Salvamento Automático:} Arquivos salvos na pasta downloads/
\end{enumerate}

% 5. TESTES
\section{Testes Realizados}

\subsection{Plano de Testes}

Foi desenvolvido um roteiro completo de testes abrangendo:

\begin{enumerate}
    \item \textbf{Teste de Autenticação:}
    \begin{itemize}
        \item Login válido (user1/senha1)
        \item Login inválido (credenciais incorretas)
        \item Múltiplos logins simultâneos
    \end{itemize}
    
    \item \textbf{Teste de Comunicação:}
    \begin{itemize}
        \item Troca de mensagens entre 2 clientes
        \item Troca de mensagens entre 3+ clientes
        \item Replicação correta para todos os usuários
    \end{itemize}
    
    \item \textbf{Teste de Comandos Especiais:}
    \begin{itemize}
        \item Comando exit com notificação
        \item Comando shutdown com aviso de 10 segundos
    \end{itemize}
    
    \item \textbf{Teste de Transferência de Arquivos:}
    \begin{itemize}
        \item Envio de arquivo texto
        \item Recepção e salvamento automático
        \item Verificação de integridade
    \end{itemize}
\end{enumerate}

% Seção para Screenshots
\section{Capturas de Tela dos Testes}

\subsection{Teste de Autenticação}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Captura de Tela 2025-07-15 às 18.03.39.png}
    \caption{Login bem-sucedido com credenciais válidas}
    \label{fig:login_sucesso}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Captura de Tela 2025-07-15 às 18.03.46.png}
    \caption{Falha na autenticação com credenciais inválidas}
    \label{fig:login_falha}
\end{figure}

\subsection{Teste de Comunicação}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Captura de Tela 2025-07-15 às 18.05.12.png}
    \caption{Troca de mensagens entre múltiplos clientes}
    \label{fig:mensagens}
\end{figure}


\subsection{Teste de Transferência de Arquivos}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Captura de Tela 2025-07-15 às 18.03.53.png}
    \caption{Transferência de arquivo entre clientes}
    \label{fig:arquivo}
\end{figure}

\subsection{Resultados dos Testes}

(Algumas imagens ficaram distorcidas / erradas devido a forma que tiramos os prints) Todos os testes foram executados com sucesso, demonstrando:

\begin{itemize}
    \item ✅ Autenticação funcionando corretamente
    \item ✅ Mensagens replicadas para todos os clientes
    \item ✅ Suporte real para múltiplos clientes simultâneos
    \item ✅ Comandos especiais operacionais
    \item ✅ Transferência de arquivos funcional
    \item ✅ Threads operando sem conflitos
\end{itemize}

% 6. RESULTADOS
\section{Resultados Obtidos}

\subsection{Requisitos Atendidos}

O sistema desenvolvido atende a 100\% dos requisitos obrigatórios:

\begin{table}[H]
\centering
\begin{tabular}{|l|c|}
\hline
\textbf{Requisito} & \textbf{Status} \\
\hline
Paradigma cliente-servidor & X \\
Comunicação síncrona & X \\
Autenticação usuário/senha & X \\
Suporte até 10 clientes & X \\
Replicação de mensagens & X \\
Comando exit/quit & X \\
Comando shutdown & X \\
Threading no servidor & X \\
Threading no cliente & X \\
\hline
\textbf{Desafio Opcional} & X \\
\hline
Transferência de arquivos & X \\
\hline
\end{tabular}
\caption{Status dos requisitos do projeto}
\end{table}

\subsection{Métricas de Performance}

\begin{itemize}
    \item \textbf{Latência:} < 100ms para mensagens locais
    \item \textbf{Throughput:} Suporte a 10 clientes simultâneos
    \item \textbf{Confiabilidade:} 100\% dos testes aprovados
    \item \textbf{Escalabilidade:} Arquitetura preparada para expansão
\end{itemize}

% 7. ESTRUTURA DO PROJETO
\section{Estrutura do Projeto}

\subsection{Organização de Arquivos}

\begin{lstlisting}[language=bash, caption=Estrutura de diretórios]
Python-Socket/
├── servidor.py              # Servidor principal do chat
├── cliente.py               # Cliente do chat
├── arquivo_teste.txt        # Arquivo para testar transferências
├── demonstracao.py          # Script de demonstração
├── roteiro_testes.md        # Roteiro completo de testes
├── EXECUCAO_RAPIDA.md       # Guia rápido de execução
├── README.md               # Documentação principal
└── relatorio.tex           # Este relatório
\end{lstlisting}

\subsection{Documentação Desenvolvida}

\begin{itemize}
    \item \textbf{README.md:} Documentação completa do sistema
    \item \textbf{roteiro\_testes.md:} Procedimentos detalhados de teste
    \item \textbf{EXECUCAO\_RAPIDA.md:} Guia de demonstração rápida
    \item \textbf{demonstracao.py:} Script interativo de demonstração
\end{itemize}

% 8. CONCLUSÕES
\section{Conclusões}

\subsection{Objetivos Alcançados}

O projeto foi desenvolvido com sucesso, atingindo todos os objetivos propostos:

\begin{enumerate}
    \item Sistema de chat funcional e robusto
    \item Implementação correta do paradigma cliente-servidor
    \item Aplicação prática de conceitos de redes de computadores
    \item Desenvolvimento de sistema concorrente com threads
    \item Implementação adicional de transferência de arquivos
\end{enumerate}

\subsection{Aprendizados Obtidos}

Durante o desenvolvimento, foram consolidados conhecimentos sobre:

\begin{itemize}
    \item Programação com sockets TCP/IP
    \item Gerenciamento de concorrência com threads
    \item Protocolos de comunicação cliente-servidor
    \item Codificação e transmissão segura de dados
    \item Tratamento de erros em sistemas distribuídos
\end{itemize}

\subsection{Possíveis Melhorias}

Embora o sistema atenda a todos os requisitos, algumas melhorias poderiam ser implementadas:

\begin{itemize}
    \item Interface gráfica para maior usabilidade
    \item Criptografia para segurança das comunicações
    \item Persistência de mensagens em banco de dados
    \item Sistema de salas/canais separados
    \item Suporte a diferentes tipos de mídia
\end{itemize}

\subsection{Considerações Finais}

O trabalho demonstrou a aplicação prática dos conceitos teóricos estudados na disciplina de Redes de Computadores II. A implementação bem-sucedida do sistema de chat, incluindo o desafio opcional de transferência de arquivos, evidencia o domínio das tecnologias e protocolos envolvidos.

O código desenvolvido é modular, bem documentado e facilmente extensível, seguindo boas práticas de programação e engenharia de software. A documentação completa e os testes abrangentes confirmam a reprodutibilidade e confiabilidade do sistema.

% REFERÊNCIAS
\section{Referências}

\begin{enumerate}
    \item Python Software Foundation. \textit{Socket Programming HOWTO}. Disponível em: \url{https://docs.python.org/3/howto/sockets.html}
    
    \item Python Software Foundation. \textit{Threading — Thread-based parallelism}. Disponível em: \url{https://docs.python.org/3/library/threading.html}
    
    \item KUROSE, James F.; ROSS, Keith W. \textit{Redes de Computadores e a Internet: Uma Abordagem Top-Down}. 6ª ed. Pearson, 2013.
    
    \item TANENBAUM, Andrew S.; WETHERALL, David. \textit{Redes de Computadores}. 5ª ed. Pearson, 2011.
\end{enumerate}

% APÊNDICES
\newpage
\appendix

\section{Código-fonte Completo}

O código-fonte completo está disponível nos arquivos:
\begin{itemize}
    \item \texttt{servidor.py} - Implementação do servidor
    \item \texttt{cliente.py} - Implementação do cliente
    \item \texttt{demonstracao.py} - Script de demonstração
\end{itemize}

\section{Manual de Execução}

Para executar o sistema:

\begin{enumerate}
    \item Abrir terminal e navegar para a pasta do projeto
    \item Executar: \texttt{python3 servidor.py}
    \item Em outros terminais, executar: \texttt{python3 cliente.py}
    \item Fazer login com credenciais válidas (user1/senha1, user2/senha2, etc.)
    \item Trocar mensagens ou usar comandos especiais
\end{enumerate}

Para demonstração rápida:
\begin{enumerate}
    \item Executar: \texttt{python3 demonstracao.py}
    \item Seguir as instruções apresentadas
\end{enumerate}

\end{document}